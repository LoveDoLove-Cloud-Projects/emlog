function TplShow(t){$(".option").hide(),$("."+t).fadeIn()}function block_drag_end(){$("form.tpl-options-form").trigger("submit")}$(function(){var i,t,e,o,n,a,s=window.tplOptions,l=$("body"),p=($('<iframe name="upload-image" src="about:blank" style="display:none"/>').appendTo(l),$("<div/>").insertAfter($("#content").find(".container-fluid .row")).addClass(k("area")).slideUp()),c=$("<div />").appendTo(l),r=$("<span />").appendTo($("#wrapper")),d=($("<span />").appendTo($("#wrapper")).attr({id:"goTopbtn",title:"返回顶部"}),$(".tpl")),u=$('<input type="file" name="image">').css({position:"absolute",margin:0,visibility:"hidden"}).on("change",function(){b(),o=t.data("target"),e.val(o),n.val(void 0),f.submit()}).on("mouseleave",function(){u.css("visibility","hidden"),t.css("visibility","visible")}),f=$('<form id="upload-form" target="upload-image" />').append(u,e=$('<input type="hidden" name="target">'),n=$('<input type="hidden" name="template">')).appendTo(l).attr({action:s.uploadUrl,target:"upload-image",enctype:"multipart/form-data",method:"post"});for(a of Object.keys(s.templates)){var m=document.querySelector("a[href*=\"em_confirm('"+a+"',\"]"),h=document.createElement("a");h.style.fontSize="12px",h.style.marginLeft="4px",m.parentNode.appendChild(h),$('<a class="btn btn-primary btn-sm">设置</span>').insertBefore(h).addClass(k("setting")).data("template",a)}l.on("click","."+k("setting"),function(){$(".container-fluid .row").fadeToggle(),$.ajax({url:s.baseUrl,data:{template:$(this).data("template")},cache:!1,beforeSend:function(){b(),editorMap={}},success:function(t){p.html(t).show(),d.hide(),window.setTimeout(function(){$(".option-sort-left").each(function(){$(this).find(".option-sort-name:first").addClass("selected")}),$(".option-sort-right").each(function(){$(this).find(".option-sort-option:first").addClass("selected")}),v(),setTimeout(function(){b(!1)},0)},1e3)}})}).on("click",".tpl-options-menu ul li,.tpl-nav-options ul li",function(){$(".tpl-options-menu ul li").removeClass("active"),$(".tpl-nav-options ul li").removeClass("active"),$(this).addClass("active")}).on("click",".tpl-options-close",function(){$(".container-fluid .row").fadeToggle(),p.slideUp(500),d.show()}).on("click","#goTopbtn",function(){$("body,html").animate({scrollTop:0},500)}).on("click",".option-name",function(){$(this).find(".option-description").fadeToggle(),$(this).parent().find(".option-body").fadeToggle(),$(this).parent().find(".option-ico").hasClass("upico")?$(this).parent().find(".option-ico").removeClass("upico").addClass("downico"):$(this).parent().find(".option-ico").removeClass("downico").addClass("upico")}).on("click",".tpl-options-menu li",function(){}).on("click",".vtpl-menu,.vtpl-nav.show ul li,.fixed-body",function(){$(".vtpl-nav").toggleClass("show")}).on("click",".tpl-options-menubtn",function(){$(".tpl-options-menu").fadeToggle()}).on("click",".tpl-options-btns",function(){1==$(this).attr("data-type")?($(this).text("全部展开").attr("data-type",0),$(".option-body").fadeOut(),$(".option-description").fadeOut(),$(".option-ico").removeClass("upico").addClass("downico")):($(this).text("全部收缩").attr("data-type",1),$(".option-body").fadeIn(),$(".option-description").fadeIn(),$(".option-ico").removeClass("downico").addClass("upico"))}).on("click",".option-sort-name",function(){var t,e,i=$(this);i.is(".selected")||(e=(t=i.parent()).siblings(".option-sort-right"),t.find(".selected").removeClass("selected"),i.addClass("selected"),e.find(".option-sort-option").removeClass("selected").eq(i.index()).addClass("selected"))}).on("change",".option-sort-select",function(){var t=$(this);t.parent().siblings(".option-sort-right").find(".option-sort-option").removeClass("selected").eq(t.find("option:selected").index()).addClass("selected")}).on("input propertychange paste change focus",".chosen-search-input",function(){_this_val=$(this).val().replace(/(^\s*)|(\s*$)/g,"");var t=$(this).attr("data-opt");let e="."+t;var i=$(e+" .chosen-drop");""===_this_val?(i.css("clip","rect(0, 0, 0, 0)"),i.css("clip-path","inset(100% 100%)")):(i.css("clip","auto"),i.css("clip-path","none"),(i=new FormData).append("action","tpl_select_search"),i.append("kywd",$(this).val()),i.append("name",$(this).attr("data-s-name")),i.append("type",t),$.ajax({url:$(this).attr("data-url")+"content/plugins/tpl_options/actions/search.php",type:"post",data:i,cache:!1,processData:!1,contentType:!1,success:function(t){$(e+" .chosen-drop .chosen-results").html(t)},error:function(t){$(e+" .chosen-drop .chosen-results").html(t)}}))}).on("click",".chosen-results .active-result",function(){var t=$(this).html(),e=$(this).attr("data-s-name"),i=$(this).attr("data-id"),n="."+$(this).attr("data-opt"),o=$(n+" .chosen-search-input"),a=$(n+" .chosen-drop");$(n+" .search-field").before('<li class="search-choice"><span>'+t+'</span><a class="search-choice-close"><i class="icofont-close"></i></a><input class="d-none" name="'+e+'[]" type="text" value="'+i+'"></li>'),a.css("clip",""),a.css("clip-path",""),o.val(""),o.focus(),$("form.tpl-options-form").trigger("submit")}).on("click",".search-choice-close i",function(){$(this).parent().parent().remove(),$("form.tpl-options-form").trigger("submit")}).on("click",".tpl-block-title",function(){$(this).next().toggleClass("d-none"),$(this).find("span").toggleClass("icofont-rounded-right"),$(this).find("span").toggleClass("icofont-rounded-down")}).on("click",".tpl-add-block",function(){var t=$(this).attr("data-b-name"),e=$(this).attr("data-type"),i=$(this).attr("data-url");let n="";"image"===e?(n='<div class="tpl-block-upload"><span>填写块标题：</span><input class="block-title-input" type="text" name="'+t+'[title][]" value=""><div class="tpl-image-preview"><img src=""></div><div class="tpl-block-upload-input"><input type="text" name="'+t+'[content][]" value=""><label>\n<a class="btn btn-primary"><i class="icofont-plus"></i>上传</a>\n<input class="d-none tpl-image" type="file" name="image" data-url="'+i+'" accept="image/gif,image/jpeg,image/jpg,image/png">\n</label>',n+="</div></div>"):n=(n=n+'<span>填写块标题：</span><input class="block-title-input" type="text" name="'+t+'[title][]" value="">')+'<span>填写块内容：</span><textarea rows="8" name="'+t+'[content][]"></textarea>',$(this).before('<div class="tpl-block-item">\n    <div class="tpl-block-head">\n    <i class="tpl-block-clone icofont-ui-copy"></i>\n    <i class="tpl-block-remove icofont-close icofont-md"></i>\n    </div>\n    <h4 class="tpl-block-title">\n    <span class="tpl-block-title-icon icofont-rounded-right"></span>\n    <item class="block-title-text"></item>    </h4>\n    <div class="tpl-block-content d-none">\n'+n+"    </div>\n</div>"),$("form.tpl-options-form").trigger("submit")}).on("change",".tpl-image",function(){let e=this;var t=$(this).prop("files")[0],i=$(this).attr("data-url");let n=$(this).parent().parent().find('input[type="text"]'),o=$(this).parent().parent().prev().find("img");var a=new FormData;null!=t&&(a.append("action","tpl_upload"),a.append("image",t),a.append("origin_image",n.val()),$.ajax({url:i+"content/plugins/tpl_options/actions/tpl.php",type:"post",data:a,cache:!1,processData:!1,contentType:!1,success:function(t){t=JSON.parse(t);"success"===t.code?(n.val(t.data),o.attr("src",t.data+"?"+(new Date).getTime()),e.value="",$("form.tpl-options-form").trigger("submit")):y(1,t.data)},error:function(t){y(1,"网络异常")}}))}).on("click",".tpl-block-remove",function(){confirm("真的要删除吗？")&&($(this).parent().parent().remove(),$("form.tpl-options-form").trigger("submit"))}).on("click",".tpl-block-clone",function(){var t=$(this).parent().parent().clone();$(this).parent().parent().after(t),$("form.tpl-options-form").trigger("submit")}).on("input change focus",".block-title-input",function(){let t=$(this).parent().prev().find("item");(t=$(this).parent().hasClass("tpl-block-upload")?$(this).parent().parent().prev().find("item"):t).html($(this).val())}).on("click",'.vtpl-switch-item input[type="checkbox"]',function(){$(this).is(":checked")?$(this).parent().parent().addClass("vtpl-checked"):$(this).parent().parent().removeClass("vtpl-checked")}).on("mouseenter",'.tpl-options-form input[type="file"]',function(){t=$(this),u.css(t.offset()),t.css("visibility","hidden"),u.css("visibility","visible")}).on("submit","form.tpl-options-form",function(){var t=$(this);return $.ajax({url:t.attr("action"),type:"post",data:t.serialize(),cache:!1,dataType:"json",success:function(t){y(t.code,t.msg)},error:function(){y(1,"网络异常")},complete:function(){}}),!1}).on("change",".tpl-options-form input:not(.chosen-search-input,.tpl-image), .tpl-options-form textarea",function(){$("form.tpl-options-form").trigger("submit")});g=0;var g,v=function(){$(".option-rich-text").each(function(){var t=$(this);void 0===t.attr("id")&&t.attr("id","option-rich-text-"+g++)}),window.setTimeout(function(){for(var t in editorMap)editorMap[t].container[0].style.width=""},100)};function b(t){(t=void 0===t?!0:t)?c.addClass("loading"):c.removeClass("loading")}function y(t,e){r.text(e).show(),0==t?(r.attr("class","tpl-activebox"),i&&window.clearTimeout(i),i=window.setTimeout(function(){r.hide()},2600)):r.attr("class","tpl-errorbox")}function k(t){return s.prefix+t}window.setImage=function(t,e,i,n){0==i?($('[name="'+o+'"]').val(e).trigger("change"),$('[data-name="'+o+'"]').attr("href",t).find("img").attr("src",t)):alert("上传失败："+n),u.val(""),o="",b(!1)}}),$(window).scroll(function(){50<$(this).scrollTop()?$("#goTopbtn").fadeIn():$("#goTopbtn").fadeOut()});