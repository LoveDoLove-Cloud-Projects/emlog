function TplShow(t){$(".option").hide(),$("."+t).fadeIn()}function block_drag_end(){$("form.tpl-options-form").trigger("submit")}$(function(){var n,t,o,e,i,s,a=window.tplOptions,c=$("body"),l=($('<iframe name="upload-image" src="about:blank" style="display:none"/>').appendTo(c),$("<div/>").insertAfter($("#content").find(".container-fluid .row")).addClass(w("area")).slideUp()),p=$("<div />").appendTo(c),r=$("<span />").appendTo($("#wrapper")),d=($("<span />").appendTo($("#wrapper")).attr({id:"goTopbtn",title:"返回顶部"}),$(".tpl")),f=$('<input type="file" name="image">').css({position:"absolute",margin:0,visibility:"hidden"}).on("change",function(){b(),e=t.data("target"),o.val(e),i.val(void 0),u.submit()}).on("mouseleave",function(){f.css("visibility","hidden"),t.css("visibility","visible")}),u=$('<form id="upload-form" target="upload-image" />').append(f,o=$('<input type="hidden" name="target">'),i=$('<input type="hidden" name="template">')).appendTo(c).attr({action:a.uploadUrl,target:"upload-image",enctype:"multipart/form-data",method:"post"});for(s of Object.keys(a.templates)){var h=document.querySelector("a[href*=\"em_confirm('"+s+"',\"]"),m=document.createElement("a");m.style.fontSize="12px",m.style.marginLeft="4px",h.parentNode.appendChild(m),$('<a class="btn btn-primary btn-sm">设置</span>').insertBefore(m).addClass(w("setting")).data("template",s)}c.on("click","."+w("setting"),function(){$(".container-fluid .row").fadeToggle(),$.ajax({url:a.baseUrl,data:{template:$(this).data("template")},cache:!1,beforeSend:function(){b(),editorMap={}},success:function(t){l.html(t).show(),d.hide(),window.setTimeout(function(){$(".option-sort-left").each(function(){$(this).find(".option-sort-name:first").addClass("selected")}),$(".option-sort-right").each(function(){$(this).find(".option-sort-option:first").addClass("selected")}),v(),setTimeout(function(){b(!1)},0)},1e3)}})}).on("click",".tpl-options-menu ul li,.tpl-nav-options ul li",function(){$(".tpl-options-menu ul li").removeClass("active"),$(".tpl-nav-options ul li").removeClass("active"),$(this).addClass("active")}).on("click",".tpl-options-close",function(){$(".container-fluid .row").fadeToggle(),l.slideUp(500),d.show()}).on("click","#goTopbtn",function(){$("body,html").animate({scrollTop:0},500)}).on("click",".option-name",function(){$(this).find(".option-description").fadeToggle(),$(this).parent().find(".option-body").fadeToggle(),$(this).parent().find(".option-ico").hasClass("upico")?$(this).parent().find(".option-ico").removeClass("upico").addClass("downico"):$(this).parent().find(".option-ico").removeClass("downico").addClass("upico")}).on("click",".tpl-options-menu li",function(){}).on("click",".vtpl-menu,.vtpl-nav.show ul li,.fixed-body",function(){$(".vtpl-nav").toggleClass("show")}).on("click",".tpl-options-menubtn",function(){$(".tpl-options-menu").fadeToggle()}).on("click",".tpl-options-btns",function(){1==$(this).attr("data-type")?($(this).text("全部展开").attr("data-type",0),$(".option-body").fadeOut(),$(".option-description").fadeOut(),$(".option-ico").removeClass("upico").addClass("downico")):($(this).text("全部收缩").attr("data-type",1),$(".option-body").fadeIn(),$(".option-description").fadeIn(),$(".option-ico").removeClass("downico").addClass("upico"))}).on("click",".option-sort-name",function(){var t,o,n=$(this);n.is(".selected")||(o=(t=n.parent()).siblings(".option-sort-right"),t.find(".selected").removeClass("selected"),n.addClass("selected"),o.find(".option-sort-option").removeClass("selected").eq(n.index()).addClass("selected"))}).on("change",".option-sort-select",function(){var t=$(this);t.parent().siblings(".option-sort-right").find(".option-sort-option").removeClass("selected").eq(t.find("option:selected").index()).addClass("selected")}).on("input propertychange paste change focus",".chosen-search-input",function(){_this_val=$(this).val().replace(/(^\s*)|(\s*$)/g,"");var t=$(this).attr("data-opt");let o="."+t;var n=$(o+" .chosen-drop");""===_this_val?(n.css("clip","rect(0, 0, 0, 0)"),n.css("clip-path","inset(100% 100%)")):(n.css("clip","auto"),n.css("clip-path","none"),(n=new FormData).append("action","tpl_select_search"),n.append("kywd",$(this).val()),n.append("name",$(this).attr("data-s-name")),n.append("type",t),$.ajax({url:$(this).attr("data-url")+"content/plugins/tpl_options/actions/search.php",type:"post",data:n,cache:!1,processData:!1,contentType:!1,success:function(t){$(o+" .chosen-drop .chosen-results").html(t)},error:function(t){$(o+" .chosen-drop .chosen-results").html(t)}}))}).on("click",".chosen-results .active-result",function(){var t=$(this).html(),o=$(this).attr("data-s-name"),n=$(this).attr("data-id"),i="."+$(this).attr("data-opt"),e=$(i+" .chosen-search-input"),s=$(i+" .chosen-drop");$(i+" .search-field").before('<li class="search-choice"><span>'+t+'</span><a class="search-choice-close"><i class="icofont-close"></i></a><input class="d-none" name="'+o+'[]" type="text" value="'+n+'"></li>'),s.css("clip",""),s.css("clip-path",""),e.val(""),e.focus(),$("form.tpl-options-form").trigger("submit")}).on("click",".search-choice-close i",function(){$(this).parent().parent().remove(),$("form.tpl-options-form").trigger("submit")}).on("click",".tpl-block-title",function(){$(this).next().toggleClass("d-none"),$(this).find("span").toggleClass("icofont-rounded-right"),$(this).find("span").toggleClass("icofont-rounded-down")}).on("click",".tpl-add-block",function(){var t="<span>填写内容：</span>";t+='<input type="text" name="'+$(this).attr("data-b-name")+'[]" value="">',$(this).before('<div class="tpl-block-item">\n    <div class="tpl-block-head">\n<i class="tpl-block-clone icofont-ui-copy"></i>\n        <i class="tpl-block-remove icofont-close icofont-md"></i>\n    </div>\n    <h4 class="tpl-block-title">\n        <span class="tpl-block-title-icon icofont-rounded-right"></span>\n    </h4>\n    <div class="tpl-block-content d-none">\n'+t+"    </div>\n</div>"),$("form.tpl-options-form").trigger("submit")}).on("click",".tpl-block-remove",function(){confirm("真的要删除吗？")&&($(this).parent().parent().remove(),$("form.tpl-options-form").trigger("submit"))}).on("click",".tpl-block-clone",function(){var t=$(this).parent().parent().clone();$(this).parent().parent().after(t),$("form.tpl-options-form").trigger("submit")}).on("mouseenter",'.tpl-options-form input[type="file"]',function(){t=$(this),f.css(t.offset()),t.css("visibility","hidden"),f.css("visibility","visible")}).on("submit","form.tpl-options-form",function(){var t=$(this);return $.ajax({url:t.attr("action"),type:"post",data:t.serialize(),cache:!1,dataType:"json",success:function(t){y(t.code,t.msg)},error:function(){y(1,"网络异常")},complete:function(){}}),!1}).on("change",".tpl-options-form input:not(.chosen-search-input), .tpl-options-form textarea",function(){$("form.tpl-options-form").trigger("submit")});g=0;var g,v=function(){$(".option-rich-text").each(function(){var t=$(this);void 0===t.attr("id")&&t.attr("id","option-rich-text-"+g++)}),window.setTimeout(function(){for(var t in editorMap)editorMap[t].container[0].style.width=""},100)};function b(t){(t=void 0===t?!0:t)?p.addClass("loading"):p.removeClass("loading")}function y(t,o){r.text(o).show(),0==t?(r.attr("class","tpl-activebox"),n&&window.clearTimeout(n),n=window.setTimeout(function(){r.hide()},2600)):r.attr("class","tpl-errorbox")}function w(t){return a.prefix+t}window.setImage=function(t,o,n,i){0==n?($('[name="'+e+'"]').val(o).trigger("change"),$('[data-name="'+e+'"]').attr("href",t).find("img").attr("src",t)):alert("上传失败："+i),f.val(""),e="",b(!1)}}),$(window).scroll(function(){50<$(this).scrollTop()?$("#goTopbtn").fadeIn():$("#goTopbtn").fadeOut()});